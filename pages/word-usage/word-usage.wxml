<view class="word-usage-page">
  <!-- 单词卡片 -->
  <view class="word-card" bindtap="onWordCardTap">
    <view class="word-header">
      <text class="word-spelling">{{baseWord}}</text>
      <view class="word-meta">
        <text class="freq">出现 {{frequency}} 次</text>
      </view>
      <button class="sound-button" catchtap="speakWord" data-word="{{baseWord}}">
        <image class="sound-icon" src="/images/sound.png"></image>
      </button>
    </view>
    <view class="word-pronunciation">
      <text class="phonetic">美 {{dictionaryPhonetics.us}}</text>
      <text class="phonetic">英 {{dictionaryPhonetics.uk}}</text>
    </view>
    <view class="word-meaning" wx:if="{{meaning}}">{{meaning}}</view>
  </view>

  <!-- 语境例句列表 -->
  <view class="sentences-section">
    <view class="section-title">字幕中的出现</view>
    <block wx:for="{{occurrences}}" wx:key="occKey">
      <view class="sentence-item" id="{{item.occKey}}" data-index="{{index}}" data-occ-key="{{item.occKey}}" bindtap="onSentenceTap">
        <view class="time-row">
          <text class="time-code">{{item.time}}</text>
          <text class="course" wx:if="{{item.courseTitle}}">{{item.courseTitle}}</text>
        </view>
        <view class="sentence-text">
          <text
            wx:for="{{item.tokens}}"
            wx:key="id"
            wx:for-item="token"
            wx:for-index="tokenIndex"
            id="{{token.id}}"
            class="word-token {{token.isWord ? 'word' : 'plain'}} {{token.isTarget ? 'highlight' : ''}}"
            data-word="{{token.word}}"
            data-token-id="{{token.id}}"
            catchtap="onTokenTap"
            space="nbsp"
          >{{token.text}}</text>
        </view>
        <text class="sentence-translation" wx:if="{{item.zh}}">{{item.zh}}</text>
      </view>
    </block>
    <view class="empty" wx:if="{{!occurrences.length}}">暂无字幕记录</view>
  </view>

  <!-- 简明词典卡片 -->
  <view class="dictionary-modal" wx:if="{{showDictionary}}" style="top: {{modalTop}}px; left: {{modalLeft}}px; width: {{modalWidth || 340}}px;">
    <view class="dict-header">
      <view class="dict-title-row">
        <view class="dict-word-container">
          <text class="dict-word">{{dictionaryWord}}</text>
          <view class="favorite-btn {{isFavorited ? 'active' : ''}}" catchtap="toggleFavorite">
            <image class="heart-icon" src="/images/heart.png"></image>
            <text class="fav-status">{{isFavorited ? '-' : '+'}}</text>
          </view>
        </view>
        <view class="dict-phonetics">
          <text>美 {{dictionaryPhonetics.us}}</text>
          <text>英 {{dictionaryPhonetics.uk}}</text>
        </view>
      </view>
      <view class="dict-actions">
        <button class="close-button" bindtap="closeDictionary">
          <text>×</text>
        </button>
      </view>
    </view>

    <view class="dict-meanings">
      <block wx:for="{{dictionaryDefinitions}}" wx:key="index">
        <view class="meaning-item">
          <text class="pos">{{item.pos}}</text>
          <text class="meaning">{{item.meaning}}</text>
        </view>
      </block>
    </view>
    <button class="more-button" bindtap="closeDictionary">关闭</button>
  </view>
</view>
